<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Hosted Payment Page</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
      <script src="javascripts/all_nosearch.js" type="text/javascript"></script>

  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <div class="logo-wrapper">
        <img src="images/logo.png" />
      </div>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='http://github.com/tripit/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        
          <h1 id="introduction">Introduction</h1>

<p>Hosted Payment Page (for short HPP) is a service provided for merchants using
DP Payment Gateway for fast and easy payment integration. It lifts off need
for PCI DSS certification from merchant, because no sensitive data is
processed by merchants backend.</p>

<p><a title="HPP Integration Flow diagram" href="images/integration_flow.png"><img alt="HPP Integration Flow diagram" src="images/integration_flow.png" /></a></p>

<p>Above diagram shows simplified communication with HPP that needs to be done by
merchant willing to use this service.</p>

<p>All requests are following basic REST principles of designing API.</p>

          <h1 id="api">API</h1>

<p><strong>Note</strong>: All requests commands examples are using
<a href="https://github.com/jkbrzt/httpie">httpie</a> for readability, but will of course
work using any http tool or library.</p>

          <h2 id="authentication">Authentication</h2>

<p>In order to use API requests need to contain merchant API token either
generated using Helios API or Merchant Panel. Lack of token or invalid token
will result in HTTP code 401 and response.</p>

<blockquote>
<p>Example request</p>
</blockquote>
<pre><code class="highlight shell">  http POST http://hpp-domain/payment <span class="nv">x_account_id</span><span class="o">=</span>wrong_or_missing_api_token
</code></pre>

<blockquote>
<p>Example response</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"invalid"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

          <h2 id="creating-payment">Creating payment</h2>

<p>In order to start HPP payment flow merchant shop needs to make payment
creation request. This request expects number of arguments that describe
payment details:</p>

<h3 id="input-params">Input Params</h3>

<table><thead>
<tr>
<th>key</th>
<th>type</th>
<th>required</th>
<th>description</th>
</tr>
</thead><tbody>
<tr>
<td>x_account_id</td>
<td>String</td>
<td>yes</td>
<td>Account ID</td>
</tr>
<tr>
<td>x_currency</td>
<td>String</td>
<td>yes</td>
<td>Transaction currency</td>
</tr>
<tr>
<td>x_amount</td>
<td>Integer</td>
<td>yes</td>
<td>Transaction amount (amount in cents or other smallest monetary unit for that currency)</td>
</tr>
<tr>
<td>x_reference</td>
<td>String</td>
<td>yes</td>
<td>Custom field to be shown in customers billing</td>
</tr>
<tr>
<td>x_url_cancel</td>
<td>String</td>
<td>yes</td>
<td>Redirection URL for cancelled transaction</td>
</tr>
<tr>
<td>x_url_complete</td>
<td>String</td>
<td>yes</td>
<td>Redirection URL for completed transaction</td>
</tr>
<tr>
<td>x_customer_first_name</td>
<td>String</td>
<td>no</td>
<td>Customers first name</td>
</tr>
<tr>
<td>x_customer_last_name</td>
<td>String</td>
<td>no</td>
<td>Customers last name</td>
</tr>
<tr>
<td>x_customer_email</td>
<td>String</td>
<td>no</td>
<td>Customers email</td>
</tr>
<tr>
<td>x_customer_phone</td>
<td>String</td>
<td>no</td>
<td>Customers phone</td>
</tr>
<tr>
<td>x_customer_shipping_city</td>
<td>String</td>
<td>no</td>
<td>Customers shipping city</td>
</tr>
<tr>
<td>x_customer_shipping_company</td>
<td>String</td>
<td>no</td>
<td>Customers shipping company</td>
</tr>
<tr>
<td>x_customer_shipping_address1</td>
<td>String</td>
<td>no</td>
<td>Customers shipping address1</td>
</tr>
<tr>
<td>x_customer_shipping_address2</td>
<td>String</td>
<td>no</td>
<td>Customers shipping address2</td>
</tr>
<tr>
<td>x_customer_shipping_zip</td>
<td>String</td>
<td>no</td>
<td>Customers shipping zip code</td>
</tr>
<tr>
<td>x_customer_shipping_country</td>
<td>String</td>
<td>no</td>
<td>Customers shipping country</td>
</tr>
<tr>
<td>x_customer_shipping_phone</td>
<td>String</td>
<td>no</td>
<td>Customers shipping phone</td>
</tr>
<tr>
<td>x_customer_shipping_state</td>
<td>String</td>
<td>no</td>
<td>Customers shipping state</td>
</tr>
<tr>
<td>x_timestamp</td>
<td>String</td>
<td>no</td>
<td></td>
</tr>
<tr>
<td>x_signature</td>
<td>String</td>
<td>no</td>
<td></td>
</tr>
<tr>
<td>x_amount_shipping</td>
<td>String</td>
<td>no</td>
<td></td>
</tr>
<tr>
<td>x_amount_tax</td>
<td>String</td>
<td>no</td>
<td></td>
</tr>
<tr>
<td>x_shop_country</td>
<td>String</td>
<td>no</td>
<td></td>
</tr>
<tr>
<td>x_shop_name</td>
<td>String</td>
<td>no</td>
<td></td>
</tr>
<tr>
<td>x_transaction_type</td>
<td>String</td>
<td>no</td>
<td></td>
</tr>
<tr>
<td>x_test</td>
<td>String</td>
<td>no</td>
<td></td>
</tr>
<tr>
<td>x_url_callback</td>
<td>String</td>
<td>no</td>
<td></td>
</tr>
<tr>
<td>x_description</td>
<td>String</td>
<td>no</td>
<td></td>
</tr>
</tbody></table>

<p>Please note that redirection urls are useful for finalizing flow, but
generally should not be used to update payment status in merchant backend.
These redirects can be tampered with by user, so secure way for receiving
payment status update is to setup callback url which is called by the gateway
itself.</p>

<h3 id="response">Response</h3>

<p>If successfully created HTTP 201 code should be expected. Returned token is
payment identifier, which is used to finalize payment in communication with
user.</p>

<table><thead>
<tr>
<th>key</th>
<th>type</th>
<th>required</th>
<th>description</th>
</tr>
</thead><tbody>
<tr>
<td>token</td>
<td>String</td>
<td>yes</td>
<td>Payment identifying token</td>
</tr>
</tbody></table>

<p>User browser should be redirected to <code class="prettyprint">http://hpp-domain/payments/#{token}</code></p>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5c0f422f303ebecc56c92eda6517fe2e"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

          <h1 id="webhooks">Webhooks</h1>

<p>You can define webhooks for your account in a Merchant Management Panel, after
that your shop can be notified about certain events. You can specify separate
URL for each event and channel. Regardless of event type payload structure is the
same.</p>

<p>Notification will be send as <code class="prettyprint">HTTP POST</code> request to the defined endpoint. Body
is JSON.</p>

<h3 id="payload-description">Payload description</h3>

<table><thead>
<tr>
<th>key</th>
<th>type</th>
<th>description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>string</td>
<td>id of the event</td>
</tr>
<tr>
<td>event_type</td>
<td>string</td>
<td>event description</td>
</tr>
<tr>
<td>source_type</td>
<td>string</td>
<td>resource type</td>
</tr>
<tr>
<td>source_id</td>
<td>string</td>
<td>id of the source resource</td>
</tr>
<tr>
<td>created_at</td>
<td>string</td>
<td>date represented as ISO8601 string</td>
</tr>
</tbody></table>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="s2">"304"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"event_type"</span><span class="p">:</span><span class="s2">"payment.statusChanged.approved.506540696413405817"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"source_type"</span><span class="p">:</span><span class="s2">"payment"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"source_id"</span><span class="p">:</span><span class="s2">"506540696413405817"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"created_at"</span><span class="p">:</span><span class="s2">"2016-09-20T11:25:56.694252787+02:00"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="event_type-key"><code class="prettyprint">event_type</code> key</h3>

<p>It has 4 parts devided by <code class="prettyprint">.</code> mark.</p>

<ol>
<li>Source type</li>
<li>Event name</li>
<li>Event details</li>
<li>Affected id</li>
</ol>

<p>eg. payment.statusChanged.approved.1234</p>

<p>The possible values are:</p>

<ul>
<li>payment

<ul>
<li>.statusChanged

<ul>
<li>.new</li>
<li>.pending</li>
<li>.approved</li>
<li>.declined</li>
<li>.error</li>
<li>.partially_paid</li>
<li>.partially_refunded</li>
<li>.refunded</li>
<li>.voided</li>
<li>.chargebacked</li>
<li>.in_progress

<ul>
<li>.TRANSACTION_ID</li>
</ul></li>
</ul></li>
</ul></li>
</ul>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>
